webpackJsonp([33],{FiYw:function(t,s){},KwVu:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e("mvHQ"),n=e.n(i),a={name:"scanfs",data:function(){return{allFiles:"",mp3file:[],cancleLoadings:!1,phoneGUrl:"",isShowMp3:!1,audioIndex:0,playMp3Title:""}},mounted:function(){this.isApp&&(this.phoneGUrl=this.commonFn.rootDirectory()),this.getMp3File()},methods:{scanAllMp3:function(){var t=this;if(this.isApp){var s=api.require("fs");this.fileAll(s,""),api.setKeepScreenOn({keepOn:!0}),this.commonFn.showLoading("正在扫描...");var e=0,i=!1,n=setInterval(function(){t.cancleLoadings==i?e=++e:(e=0,i=t.cancleLoadings),16==e&&(t.commonFn.hideLoading(),t.commonFn.showMsg({text:"扫描完成！"}),clearInterval(n),api.setKeepScreenOn({keepOn:!1}))},500)}},fileAll:function(t,s){var e=this,i=this.mp3file?this.mp3file:[];t.readDir({path:e.phoneGUrl+s},function(n,a){if(n.status)if(e.cancleLoadings=!1,n.data&&$api.isArray(n.data))for(var l=0;l<n.data.length;l++)e.regCancle(n.data[l])||function(i){setTimeout(function(){e.fileAll(t,s?s+"/"+n.data[i]:n.data[i])},1800)}(l);else e.regMp3(n.data)&&(0==i.length?i[0]=n.data:i.push(n.data),e.mp3file=i);else e.regMp3(e.phoneGUrl+s)&&(0==i.length?i[0]=e.phoneGUrl+s:i.push(e.phoneGUrl+s),e.mp3file=i),e.cancleLoadings=!0})},showMp3List:function(){this.isShowMp3=!this.isShowMp3},saveMp3:function(){for(var t=this,s=t.mp3file,e=[],i=0;i<s.length;i++){var a=s[i].split("/"),l={title:a[a.length-1].split(".mp3")[0],url:s[i],singer:"",duration:"",releaseDate:"",like:!1};e[i]=l}this.commonFn.openFiles({filePath:"pingData/phoneAllMp3.txt"}).then(function(s){s.status?t.commonFn.writeFiles({filePath:"pingData/phoneAllMp3.txt",data:n()(e),overwrite:!0}).then(function(s){s.status&&t.commonFn.showMsg({text:"保存成功！"})}):t.commonFn.createFile({filePath:"pingData/phoneAllMp3.txt"}).then(function(s){s.status&&t.commonFn.writeFiles({filePath:"pingData/phoneAllMp3.txt",data:n()(e),overwrite:!0}).then(function(s){s.status&&t.commonFn.showMsg({text:"保存成功！"})})})})},regMp3:function(t){return RegExp(/\.mp3$/).test(t)},regCancle:function(t){return RegExp(/Android$|gifshow$|alipay$|backup$|backups$|DCIM$/).test(t)},getMp3File:function(){var t=this;if(!this.isApp)return!1;this.commonFn.readFiles({filePath:"pingData/phoneAllMp3.txt"}).then(function(s){s.status&&(t.mp3file=JSON.parse(s.data))})},showBrowser:function(){var t=this;if(this.isApp){var s=api.require("fileBrowser");s.open(function(e){e&&(t.commonFn.getAttrFile({cancelPath:!0,filePath:e.url}).then(function(t){alert(n()(t))}),s.close())})}},scanAttrMp3:function(){if(!this.isApp)return!1;var t=api.require("fs");this.getFileAttr(t,0,this.mp3file)},getFileAttr:function(t,s,e){var i=this;t.getAttribute({path:e[s]},function(a,l){if(a.status){var o=e,p={};p.fileurl=e[s],p.fileInfo=a,o[s]=p,i.mp3file=o,s+1<o.length?i.getFileAttr(t,++s,o):(i.allMp3File=o,i.strMp3File=n()(o))}else alert(n()(l))})},playMp3:function(){this.playMp3Title=this.mp3file[this.audioIndex],api.startPlay({path:this.mp3file[this.audioIndex]},function(t,s){t||alert(n()(s))})},stopPlay:function(){api.stopPlay()},playPrev:function(){api.stopPlay(),this.audioIndex=--this.audioIndex,this.playMp3()},playNext:function(){api.stopPlay(),this.audioIndex=++this.audioIndex,this.playMp3()}}},l={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"scanfs"},[e("div",{staticClass:"scanfsNav"},[e("ul",{staticClass:"list2"},[e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.showBrowser}},[t._v("打开文件浏览")])]),t._v(" "),e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.scanAllMp3}},[t._v("扫描所有mp3文件")])]),t._v(" "),e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.showMp3List}},[t._v(t._s(t.isShowMp3?"隐藏":"显示")+"mp3列表")])]),t._v(" "),e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.saveMp3}},[t._v("保存mp3文件")])]),t._v(" "),t._m(0),t._v(" "),e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.playMp3}},[t._v("播放音乐")])]),t._v(" "),e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.playPrev}},[t._v("播放上一首")])]),t._v(" "),e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.playNext}},[t._v("播放下一首")])]),t._v(" "),e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.stopPlay}},[t._v("停止播放")])])])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMp3,expression:"isShowMp3"}],staticClass:"scanfsMp3"},[e("div",{staticClass:"scanfsMp3List"},[e("h4",{staticClass:"btn_primary"},[t._v("总共扫描到了"),e("span",[t._v(t._s(t.mp3file.length>0?t.mp3file.length:0))]),t._v("首mp3")]),t._v(" "),e("ul",t._l(t.mp3file,function(s,i){return e("li",{key:i},[t._v(t._s(s))])}),0),t._v(" "),e("p",{directives:[{name:"show",rawName:"v-show",value:t.mp3file.length<1,expression:"mp3file.length<1"}]},[t._v("-- 没有文件 --")])])]),t._v(" "),e("div",{staticClass:"playMp3Title"},[t._v(t._s(t.playMp3Title))])])},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"}},[this._v("扫描图片")])])}]};var o=e("VU/8")(a,l,!1,function(t){e("FiYw")},null,null);s.default=o.exports}});