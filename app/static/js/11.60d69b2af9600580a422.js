webpackJsonp([11],{O88V:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={name:"drawingboard",data:function(){return{handleStatus:!1,showNum:0,showSaveStatus:!1,createImgUrl:""}},mounted:function(){this.initDraw()},methods:{initDraw:function(){console.log(window);var t,e,o,s,i=window.devicePixelRatio,a=!1,n=document.getElementById("mycanvas"),c=n.getContext("2d");t=window.innerWidth,e=window.innerHeight,console.log(t+"----"+e);var l=document.querySelector(".main_canvas");l.style.cssText="width:winWidth;height:winHeight",o=t*i,s=e*i,n.width=o,n.height=s,n.width,n.height;var r={x:0,y:0},u={x:0,y:0},d=!1;function v(t){var e=t||window.event;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}n.onmousedown=function(t){r.x=t.pageX-void 0,r.y=t.pageY,d=!0},n.onmousemove=function(t){v(t),a?d&&(r.x=t.pageX-void 0,r.y=t.pageY,u.x=t.pageX-void 0,u.y=t.pageY,w(r.x,r.y,u.x,u.y)):d&&(u.x=t.pageX-void 0,u.y=t.pageY,w(r.x,r.y,u.x,u.y)),a=!1},n.onmouseup=function(t){v(t),d=!1,r.x=0,r.y=0,u.x=0,u.y=0},window.onmouseup=function(){d=!1},window.onmousemove=function(t){(t.pageX>n.width+void 0||t.pageX<n.width+void 0||t.pageY<0||t.pageY>n.height)&&(a=!0)},n.addEventListener("touchstart",function(t){r.x=t.touches[0].clientX*i,r.y=t.touches[0].clientY*i},!1),n.addEventListener("touchmove",function(t){u.x=t.touches[0].clientX*i,u.y=t.touches[0].clientY*i,w(r.x,r.y,u.x,u.y)},!1);var h=1;h*=i;var g="black",m=new Image;function w(t,e,o,s){c.beginPath(),c.restore(),c.save(),c.lineWidth=h,c.strokeStyle=g,c.moveTo(t,e),c.lineTo(o,s),c.stroke(),r.x=o,r.y=s,c.restore(),c.save()}function p(t,e,o,s){c.restore(),c.save(),c.beginPath(),c.drawImage(m,t,e,o,s),c.restore(),c.save()}m.src="",document.getElementById("upimgs").addEventListener("change",function(){console.log("有选择");var t,e=this.files[0];console.log(e),void 0!=window.createObjectURL?(t=window.createObjectURL(e),console.log(window.createObjectURL(e))):void 0!=window.URL?(t=window.URL.createObjectURL(e),console.log(window.URL.createObjectURL(e))):void 0!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e),console.log(window.webkitURL.createObjectURL(e))),m.src=t,m.onload=function(){var t=m.width/m.height,e=(m.width,m.height,n.width/t),o=n.height*t;e>n.height?p(0,-(e-n.height)/2,n.width,e):e<n.height&&p(-(o-n.width)/2,0,o,n.height)}}),document.getElementById("color_val").addEventListener("input",function(t){g=t.target.value,console.log(t)}),document.getElementById("sib_linecx").addEventListener("input",function(t){h=t.target.value,console.log(t)}),document.getElementById("sig_clear").addEventListener("click",function(){c.beginPath(),c.clearRect(0,0,n.width,n.height),c.restore(),c.save()});document.getElementById("save_sig"),document.querySelector(".create_imgs"),document.querySelector(".create_imgbox"),document.querySelector(".modal_bg")},showHandles:function(){var t=this;this.showNum=++this.showNum,3==this.showNum&&(this.handleStatus=!0,this.showNum=0),clearTimeout(t.setLoop),t.setLoop=setTimeout(function(){t.showNum=0,console.log(t.showNum)},1e3)},closeHandle:function(){this.handleStatus=!1,this.showNum=0},touchmoves:function(t){0!=this.showNum&&(this.showNum=0)},createImg:function(){var t=document.getElementById("mycanvas"),e=document.querySelector(".create_imgbox"),o=new Image;o.setAttribute("crossOrigin","Anonymous"),o.src=t.toDataURL("image/png"),this.createImgUrl=t.toDataURL("image/png"),console.log(o),o.style.cssText="width: 100%;display:block;",o.onload=function(){e.appendChild(o)},this.showSaveStatus=!0,this.handleStatus=!1},closeSaveImg:function(){var t=document.querySelector(".create_imgbox");console.log(t.children),t.removeChild(t.firstChild),this.showSaveStatus=!1},saveImgs:function(){this.commonFn.saveImgsToAlbum({type:"base64",hasbs64:!0,curData:this.createImgUrl})},closeSaves:function(){this.isApp&&clearTimeout(this.saveTime)}}},i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"drawingboard"},[o("div",{staticClass:"main_box"},[o("div",{staticClass:"main_canvas"},[o("canvas",{attrs:{id:"mycanvas"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.showHandles(e)},touchmove:function(e){return e.stopPropagation(),e.preventDefault(),t.touchmoves(e)}}})]),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.handleStatus,expression:"handleStatus"}],staticClass:"drawingHBoxbg",on:{click:t.closeHandle}}),t._v(" "),o("transition",{attrs:{name:"fade"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.handleStatus,expression:"handleStatus"}],staticClass:"drawingHInbox"},[o("div",{staticClass:"signature_btn"},[o("ul",{staticClass:"flexbox"},[o("li",{staticClass:"flex1"},[o("div",{staticClass:"sig_cxline"},[o("select",{attrs:{name:"",id:"sib_linecx"}},[o("option",{attrs:{value:"1"}},[t._v("1")]),t._v(" "),o("option",{attrs:{value:"2"}},[t._v("2")]),t._v(" "),o("option",{attrs:{value:"3"}},[t._v("3")]),t._v(" "),o("option",{attrs:{value:"4"}},[t._v("4")]),t._v(" "),o("option",{attrs:{value:"5"}},[t._v("5")])])])]),t._v(" "),o("li",{staticClass:"flex1"},[o("div",{staticClass:"sig_colors"},[o("input",{attrs:{id:"color_val",type:"color",readonly:"",placeholder:"选择颜色"}})])]),t._v(" "),o("li",{staticClass:"flex1"},[o("div",{staticClass:"sig_bgfile"},[o("input",{staticClass:"upfiles",attrs:{id:"upimgs",type:"file",accept:"image/*"}}),t._v(" "),o("button",{attrs:{type:"button"}},[t._v("上传背景")])])])])]),t._v(" "),o("div",{staticClass:"btnbox"},[o("ul",{staticClass:"flexbox"},[o("li",{staticClass:"flex1"},[o("button",{attrs:{id:"sig_clear",type:"button"}},[t._v("清空画布")])]),t._v(" "),o("li",{staticClass:"flex1"},[o("button",{attrs:{id:"save_sig",type:"button"},on:{click:t.createImg}},[t._v("生成图片")])])])])])]),t._v(" "),o("transition",{attrs:{name:"fade"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.showSaveStatus,expression:"showSaveStatus"}],staticClass:"create_imgs"},[o("div",{staticClass:"modal_bg",on:{click:t.closeSaveImg}}),t._v(" "),o("div",{staticClass:"create_imgbox",on:{touchstart:t.saveImgs,touchend:t.closeSaves}})])])],1)])},staticRenderFns:[]};var a=o("VU/8")(s,i,!1,function(t){o("uNmw")},"data-v-cbb169cc",null);e.default=a.exports},uNmw:function(t,e){}});