{"version":3,"sources":["webpack:///src/pages/others/drawingboard.vue","webpack:///./src/pages/others/drawingboard.vue?8340","webpack:///./src/pages/others/drawingboard.vue","webpack:///./node_modules/babel-runtime/core-js/json/stringify.js","webpack:///./node_modules/core-js/library/fn/json/stringify.js"],"names":["drawingboard","name","data","handleStatus","showNum","showSaveStatus","createImgUrl","mounted","this","initDraw","methods","console","log","window","winWidth","winHeight","canW","canH","dpr","devicePixelRatio","isOut","canvas","document","getElementById","context","getContext","innerWidth","innerHeight","main_canvas","querySelector","style","cssText","width","height","start_point","x","y","end_point","isdraw","cancelBubble","e","evt","event","stopPropagation","onmousedown","pageX","left_W","pageY","onmousemove","re_drow","onmouseup","addEventListener","touches","clientX","clientY","cxline","sig_color","bgImg","Image","stx","sty","endx","endy","beginPath","restore","save","lineWidth","strokeStyle","moveTo","lineTo","stroke","drow_bg","sx","sy","ew","eh","drawImage","src","imgUrlData","file","files","undefined","createObjectURL","URL","webkitURL","onload","bg_ratio","bgH","bgW","target","value","clearRect","showHandles","_this","clearTimeout","setLoop","setTimeout","closeHandle","touchmoves","createImg","create_imgbox","save_imgs","setAttribute","toDataURL","appendChild","closeSaveImg","children","removeChild","firstChild","saveImgs","isApp","trans","api","require","saveTime","confirm","title","msg","buttons","ret","err","buttonIndex","saveImage","album","base64Str","imgPath","imgName","Date","getTime","status","alert","stringify_default","showMsg","text","closeSaves","others_drawingboard","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","id","on","click","$event","preventDefault","touchmove","_v","directives","rawName","expression","type","readonly","placeholder","accept","touchstart","touchend","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__","module","exports","default","__esModule","core","$JSON","JSON","stringify","it","apply","arguments"],"mappings":"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","file":"static/js/4.839949eea93f6a1ac98a.js","sourcesContent":["<template>\r\n    <div class=\"drawingboard\">\r\n        <div class=\"main_box\">\r\n            <div class=\"main_canvas\">\r\n                <canvas id=\"mycanvas\" @click.stop.prevent=\"showHandles\" @touchmove.stop.prevent=\"touchmoves\"></canvas>\r\n            </div>\r\n            <div class=\"drawingHBoxbg\" @click=\"closeHandle\" v-show=\"handleStatus\"></div>\r\n            <transition name=\"fade\">\r\n                <div class=\"drawingHInbox\" v-show=\"handleStatus\">\r\n                    <div class=\"signature_btn\">\r\n                        <ul class=\"flexbox\">\r\n                            <li class=\"flex1\">\r\n                                <div class=\"sig_cxline\">\r\n                                    <select name=\"\" id=\"sib_linecx\">\r\n                                        <option value=\"1\">1</option>\r\n                                        <option value=\"2\">2</option>\r\n                                        <option value=\"3\">3</option>\r\n                                        <option value=\"4\">4</option>\r\n                                        <option value=\"5\">5</option>\r\n                                    </select>\r\n                                </div>\r\n                            </li>\r\n                            <li class=\"flex1\">\r\n                                <div class=\"sig_colors\">\r\n                                    <input id=\"color_val\" type=\"color\" readonly placeholder=\"选择颜色\">\r\n                                </div>\r\n                            </li>\r\n                            <li class=\"flex1\">\r\n                                <div class=\"sig_bgfile\">\r\n                                    <input id=\"upimgs\" type=\"file\" class=\"upfiles\" accept=\"image/*\">\r\n                                    <button type=\"button\">上传背景</button>\r\n                                </div>\r\n                            </li>\r\n                        </ul>\r\n                        \r\n                    </div>\r\n                    <div class=\"btnbox\">\r\n                        <ul class=\"flexbox\">\r\n                            <li class=\"flex1\">\r\n                                <button id=\"sig_clear\" type=\"button\">清空画布</button>\r\n                            </li>\r\n                            <li class=\"flex1\">\r\n                                <button id=\"save_sig\" @click=\"createImg\" type=\"button\">生成图片</button>\r\n                            </li>\r\n                        </ul>\r\n                        \r\n                    </div>\r\n                    \r\n                </div>\r\n                \r\n            </transition>\r\n            <transition name=\"fade\">\r\n                <div class=\"create_imgs\" v-show=\"showSaveStatus\">\r\n                    <div class=\"modal_bg\" @click=\"closeSaveImg\"></div>\r\n                    <div class=\"create_imgbox\" @touchstart=\"saveImgs\" @touchend=\"closeSaves\"></div>\r\n                </div>\r\n            </transition>\r\n            \r\n        </div>\r\n    </div>\r\n</template>\r\n<script>\r\nexport default {\r\n    name:'drawingboard',\r\n    data(){\r\n        return{\r\n            handleStatus: false,\r\n            showNum:0,\r\n            showSaveStatus: false,\r\n            createImgUrl:'',\r\n        }\r\n    },\r\n    mounted(){\r\n        this.initDraw();\r\n        \r\n    },\r\n    methods:{\r\n        initDraw(){\r\n            // 记录页面在顶部是，开始滑动的位置\r\n            var vueThis = this;\r\n            var startp={\r\n                x:0,\r\n                y:0\r\n            }\r\n            // 处理微信浏览器页面顶部下滑\r\n            // document.body.addEventListener('touchstart', function(e) {\r\n            //     startp.x = e.touches[0].clientX;\r\n            //     startp.y = e.touches[0].clientY;\r\n            // }, {passive: false})\r\n            // document.body.addEventListener('touchmove', function(e) {\r\n            //     var move_x = e.touches[0].clientX;\r\n            //     var move_y = e.touches[0].clientY;\r\n            //     if(($(window).scrollTop() <=1)&&(move_y-startp.y>0)){\r\n            //         e.preventDefault();\r\n            //     }\r\n            // }, {passive: false})\r\n            console.log(window);\r\n           \r\n            // var dpr = e.currentTarget.devicePixelRatio;//设备像素比\r\n            var dpr = window.devicePixelRatio;//设备像素比\r\n            var winWidth,winHeight,canW,canH,can_ratio,left_W;\r\n            var isMB = false;//是否为移动端\r\n            var isOut = false;//是否超出canvas\r\n            var canvas = document.getElementById('mycanvas');\r\n            var context = canvas.getContext(\"2d\");\r\n\r\n            winWidth = window.innerWidth;\r\n            winHeight = window.innerHeight;\r\n            console.log(winWidth+'----'+winHeight);\r\n            var main_canvas = document.querySelector('.main_canvas');\r\n            \r\n            main_canvas.style.cssText=\"width:winWidth;height:winHeight\"\r\n            main_canvas\r\n            isMB = true;\r\n            canW = winWidth*dpr;\r\n            canH = winHeight*dpr;\r\n            canvas.width = canW;\r\n            canvas.height = canH;\r\n               \r\n            can_ratio = canvas.width/canvas.height;//canvas比例\r\n            \r\n            // 判断是否有滚动条\r\n            // function hasScrollbar() {\r\n            //     return document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight);\r\n            // }\r\n\r\n            // 画图起点位置\r\n            var start_point = {\r\n                x:0,\r\n                y:0\r\n            };\r\n            // 画图结束点位置\r\n            var end_point = {\r\n                x:0,\r\n                y:0\r\n            }\r\n\r\n            // PC端\r\n            var isdraw = false;\r\n            canvas.onmousedown = function(e){\r\n                start_point.x = e.pageX-left_W;\r\n                start_point.y = e.pageY;\r\n                isdraw = true;\r\n            }\r\n            canvas.onmousemove = function(e){\r\n                cancelBubble(e);\r\n                if(isOut){\r\n                    if(isdraw){\r\n                        start_point.x = e.pageX-left_W;\r\n                        start_point.y = e.pageY;\r\n                        end_point.x = e.pageX-left_W;\r\n                        end_point.y = e.pageY;\r\n                        re_drow(start_point.x,start_point.y,end_point.x,end_point.y);\r\n                    }\r\n                }else{\r\n                    if(isdraw){\r\n                        end_point.x = e.pageX-left_W;\r\n                        end_point.y = e.pageY;\r\n                        re_drow(start_point.x,start_point.y,end_point.x,end_point.y);\r\n                    }\r\n                }\r\n                isOut = false;\r\n            }\r\n            canvas.onmouseup =  function(e){\r\n                cancelBubble(e);\r\n                isdraw = false;\r\n                start_point.x = 0;\r\n                start_point.y = 0;\r\n                end_point.x = 0;\r\n                end_point.y = 0;\r\n            }\r\n            window.onmouseup =  function(){\r\n                isdraw = false;\r\n            }\r\n            window.onmousemove = function(e){\r\n                // 处理边缘问题\r\n                if((e.pageX>canvas.width+left_W)||(e.pageX<canvas.width+left_W)||(e.pageY<0)||(e.pageY>canvas.height)){\r\n                    isOut = true;\r\n                }\r\n            }\r\n            // 阻止冒泡事件\r\n            function cancelBubble(e) { \r\n                var evt = e ? e : window.event; \r\n                if (evt.stopPropagation) {        \r\n                    evt.stopPropagation(); \r\n                }else {   \r\n                    evt.cancelBubble = true; \r\n                }  \r\n            }\r\n\r\n            // 移动端\r\n            // 起始位置\r\n            canvas.addEventListener('touchstart',function(e){\r\n                start_point.x = e.touches[0].clientX*dpr;\r\n                start_point.y = e.touches[0].clientY*dpr;\r\n            },false);\r\n            // 结束位置\r\n            canvas.addEventListener('touchmove',function(e){\r\n                end_point.x = e.touches[0].clientX*dpr;\r\n                end_point.y = e.touches[0].clientY*dpr;\r\n                re_drow(start_point.x,start_point.y,end_point.x,end_point.y);\r\n            },false);\r\n\r\n            var cxline = 1;//默认线条粗细\r\n            if(isMB){\r\n                // 移动端放大\r\n                cxline = cxline*dpr;\r\n            }\r\n            var sig_color = 'black';//默认线条颜色\r\n            var bgImg = new Image();//创建背景图对象\r\n            bgImg.src = '';\r\n            \r\n            // 绘制线条\r\n            function re_drow(stx,sty,endx,endy){\r\n                context.beginPath();\r\n                context.restore();\r\n                context.save();\r\n                context.lineWidth = cxline;//边框宽度\r\n                context.strokeStyle = sig_color;\r\n                context.moveTo(stx,sty);\r\n                context.lineTo(endx,endy);\r\n                context.stroke();\r\n                start_point.x = endx;\r\n                start_point.y = endy;\r\n                context.restore();\r\n                context.save();\r\n            }\r\n\r\n            // 清空画布\r\n            function clearCanvas(){\r\n                context.beginPath();\r\n                context.clearRect(0,0,canvas.width,canvas.height);\r\n                context.restore();\r\n                context.save();\r\n            }\r\n            // 上传背景图\r\n            var upimgs = document.getElementById('upimgs');\r\n            upimgs.addEventListener('change',function(){\r\n                console.log('有选择');\r\n                var _this = this;\r\n                var file = this.files[0];\r\n                console.log(file);\r\n                \r\n                \r\n                var imgUrlData;\r\n                if (window.createObjectURL!=undefined) { \r\n                    imgUrlData=window.createObjectURL(file)\r\n                    console.log(window.createObjectURL(file));\r\n                } else if (window.URL!=undefined) { // mozilla(firefox) \r\n                    imgUrlData= window.URL.createObjectURL(file);\r\n                    console.log(window.URL.createObjectURL(file));\r\n                } else if (window.webkitURL!=undefined) { // webkit or chrome \r\n                    imgUrlData= window.webkitURL.createObjectURL(file);\r\n                    console.log(window.webkitURL.createObjectURL(file));\r\n                }  \r\n                \r\n                bgImg.src = imgUrlData;\r\n                bgImg.onload = function(){\r\n                    var bg_ratio = bgImg.width/bgImg.height;//背景图比例\r\n                    var bgimg_w = bgImg.width*dpr;\r\n                    var bgimg_h = bgImg.height*dpr;\r\n                    var qd_x = 0,qd_y = 0,bgw = 0,bgh = 0;\r\n\r\n                    // 以画布宽度为宽度，获取背景高度\r\n                    var bgH =  canvas.width/bg_ratio;\r\n                    //以画布高度为高度，获取背景宽度\r\n                    var bgW = canvas.height*bg_ratio;\r\n\r\n                    if(bgH>canvas.height){\r\n                        qd_x = 0;\r\n                        qd_y = -(bgH-canvas.height)/2;\r\n                        bgw = canvas.width;\r\n                        bgh = bgH;\r\n                        drow_bg(qd_x,qd_y,bgw,bgh);\r\n                    }else if(bgH<canvas.height){\r\n                        qd_x = -(bgW-canvas.width)/2;\r\n                        qd_y = 0;\r\n                        bgw = bgW;\r\n                        bgh = canvas.height;\r\n                        drow_bg(qd_x,qd_y,bgw,bgh);\r\n                    }\r\n                }\r\n                \r\n            })\r\n            // 画入背景\r\n            function drow_bg(sx,sy,ew,eh){\r\n                context.restore();\r\n                context.save();\r\n                context.beginPath();\r\n                context.drawImage(bgImg, sx, sy, ew, eh);\r\n                context.restore();\r\n                context.save();\r\n            }\r\n            // 颜色\r\n            var color_val = document.getElementById('color_val');\r\n            color_val.addEventListener('input',function(e){\r\n                sig_color = e.target.value;\r\n                console.log(e);\r\n            })\r\n            // 粗细\r\n            var sib_linecx = document.getElementById('sib_linecx');\r\n            sib_linecx.addEventListener('input',function(e){\r\n                cxline = e.target.value;\r\n                console.log(e);\r\n            })\r\n            // 清空画布\r\n            var sig_clear = document.getElementById('sig_clear');\r\n            sig_clear.addEventListener('click',function(){\r\n                clearCanvas();\r\n            })\r\n\r\n            // 保存图片\r\n            var save_sig = document.getElementById('save_sig');\r\n            var create_imgs = document.querySelector('.create_imgs');\r\n            var create_imgbox = document.querySelector('.create_imgbox');\r\n            var modal_bg = document.querySelector('.modal_bg');\r\n            // save_sig.addEventListener('click',function(){\r\n                \r\n                \r\n            // })\r\n            // modal_bg.addEventListener('click',function(){\r\n            //     create_imgs.style.cssText ='display:none;';\r\n            //     console.log(create_imgbox.children);\r\n            //     create_imgbox.removeChild(create_imgbox.firstChild);\r\n            // })\r\n           \r\n        },\r\n        // 显示设置弹框\r\n        showHandles(){\r\n            var _this = this;\r\n            this.showNum = ++this.showNum;\r\n            if(this.showNum==3){\r\n                this.handleStatus = true;\r\n                this.showNum = 0;\r\n            }\r\n            clearTimeout(_this.setLoop);\r\n            _this.setLoop = setTimeout(function(){\r\n                _this.showNum = 0;\r\n                console.log(_this.showNum);\r\n            }, 1000);\r\n        },\r\n        // 取消设置弹框\r\n        closeHandle(){\r\n            this.handleStatus = false;\r\n            this.showNum = 0;\r\n        },\r\n        // 开始滑动\r\n        touchmoves(e){\r\n            // console.log(e);\r\n            if(this.showNum!=0){\r\n                this.showNum = 0;\r\n            }\r\n            \r\n        },\r\n        // 生成图片\r\n        createImg(){\r\n            var canvas = document.getElementById('mycanvas');\r\n            var create_imgbox = document.querySelector('.create_imgbox');\r\n            var save_imgs = new Image();\r\n            save_imgs.setAttribute(\"crossOrigin\",'Anonymous');\r\n            save_imgs.src = canvas.toDataURL(\"image/png\");//转换图片格式\r\n            this.createImgUrl = canvas.toDataURL(\"image/png\");\r\n            console.log(save_imgs);\r\n            save_imgs.style.cssText = 'width: 100%;display:block;';\r\n            save_imgs.onload = function(){\r\n                create_imgbox.appendChild(save_imgs);\r\n            }\r\n            this.showSaveStatus = true;\r\n            this.handleStatus = false;\r\n            // create_imgs.style.cssText ='display:block;';\r\n        },\r\n        // 关闭图片弹框\r\n        closeSaveImg(){\r\n            // create_imgs.style.cssText ='display:none;';\r\n            var create_imgbox = document.querySelector('.create_imgbox');\r\n            console.log(create_imgbox.children);\r\n            create_imgbox.removeChild(create_imgbox.firstChild);\r\n            this.showSaveStatus = false;\r\n        },\r\n        // 保存图片到相册\r\n        saveImgs(){\r\n            var _this = this;\r\n            if(this.isApp){\r\n                var trans = api.require('trans');\r\n                _this.saveTime = setTimeout(function(){\r\n                    api.confirm({\r\n                        title: '提示',\r\n                        msg: '是否保存图片？',\r\n                        buttons: ['确定', '取消']\r\n                    }, function(ret, err) {\r\n                        var index = ret.buttonIndex;\r\n                        if(ret.buttonIndex==1){\r\n                            trans.saveImage({\r\n                                album:true,\r\n                                base64Str: _this.createImgUrl,\r\n                                imgPath:\"fs://\",\r\n                                imgName:(new Date()).getTime()+'.png'\r\n                            }, function(ret, err) {\r\n                                if (ret.status) {\r\n                                    alert(JSON.stringify(ret));\r\n                                } else {\r\n                                    alert(JSON.stringify(err));\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                    \r\n                },600)\r\n            }else{\r\n                this.showMsg({text:'无法保存图片！'});\r\n            }\r\n        },\r\n        closeSaves(){\r\n            this.isApp?clearTimeout(this.saveTime):'';\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style scoped>\r\n    \r\n    .modal_bg{\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        background-color: rgba(0, 0, 0, 0.5);\r\n        z-index: 100;\r\n    }\r\n    .create_imgbox{\r\n        position: fixed;\r\n        top: 50%;\r\n        left: 10%;\r\n        transform: translateY(-50%);\r\n        width: 80%;\r\n        height: auto;\r\n        z-index: 101;\r\n        background-color: white;\r\n        border-radius: 6px;\r\n        overflow: hidden;\r\n    }\r\n    .create_imgbox img{\r\n        max-width: 100%;\r\n        display: block;\r\n    }\r\n    .create_imgs{\r\n        /* display: none; */\r\n    }\r\n    .sig_bgfile{\r\n        position: relative;\r\n    }\r\n\r\n    .sig_cxline,\r\n    .sig_colors{\r\n        text-align: center;\r\n        \r\n    }\r\n    .sig_cxline select,\r\n    .sig_colors input,\r\n    .sig_bgfile button{\r\n        width: 80%;\r\n        padding: 0px 10px;\r\n        border: 1px solid rgb(205, 205, 205);\r\n        height: 34px;\r\n        line-height: 34px;\r\n        border-radius: 6px;\r\n    }\r\n    .sig_colors input{\r\n        background-color: white;\r\n    }\r\n    .sig_bgfile button{\r\n        background-color: skyblue;\r\n        border: none;\r\n    }\r\n    .btnbox{\r\n        margin-top: 10px;\r\n        text-align: center;\r\n    }\r\n    .btnbox button{\r\n        width: 80%;\r\n        height: 40px;\r\n        line-height: 40px;\r\n        border: none;\r\n        border-radius: 6px;\r\n        font-size: 16px;\r\n        color: white;\r\n    }\r\n    #sig_clear{\r\n        background-color: #ec1c21;\r\n    }\r\n    #save_sig{\r\n        background-color: #27bc3e;\r\n    }\r\n    .main_canvas{\r\n        position: relative;\r\n        /* overflow: hidden; */\r\n    }\r\n    .main_canvas canvas{\r\n        /* position: absolute; */\r\n        /* top: 0; */\r\n        /* left: 0; */\r\n        /* z-index: -10; */\r\n        width: 100% !important;\r\n    }\r\n    .main_canvas img{\r\n        max-width: 100%;\r\n    }\r\n    .signature_btn{\r\n        /* margin-top: 10px; */\r\n    }\r\n\r\n    input.upfiles {\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        background-color: transparent;\r\n        border: none;\r\n        color: none;\r\n        -webkit-appearance: none;\r\n        opacity: 0;\r\n    }\r\n    input.upfiles::-webkit-file-upload-button {\r\n        border: none;\r\n        background-color: transparent;\r\n        color: transparent;\r\n        outline: none;\r\n    }\r\n\r\n    .drawingHBoxbg{\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        background-color: rgba(0, 0, 0, 0.5);\r\n        z-index: 4;\r\n    }\r\n    .drawingHInbox{\r\n        position: fixed;\r\n        top: 50%;\r\n        left: 0;\r\n        width: 100%;\r\n        transform: translateY(-50%);\r\n        z-index: 5;\r\n        background-color: white;\r\n        padding: 30px 0;\r\n    }\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/pages/others/drawingboard.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"drawingboard\"},[_c('div',{staticClass:\"main_box\"},[_c('div',{staticClass:\"main_canvas\"},[_c('canvas',{attrs:{\"id\":\"mycanvas\"},on:{\"click\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.showHandles($event)},\"touchmove\":function($event){$event.stopPropagation();$event.preventDefault();return _vm.touchmoves($event)}}})]),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.handleStatus),expression:\"handleStatus\"}],staticClass:\"drawingHBoxbg\",on:{\"click\":_vm.closeHandle}}),_vm._v(\" \"),_c('transition',{attrs:{\"name\":\"fade\"}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.handleStatus),expression:\"handleStatus\"}],staticClass:\"drawingHInbox\"},[_c('div',{staticClass:\"signature_btn\"},[_c('ul',{staticClass:\"flexbox\"},[_c('li',{staticClass:\"flex1\"},[_c('div',{staticClass:\"sig_cxline\"},[_c('select',{attrs:{\"name\":\"\",\"id\":\"sib_linecx\"}},[_c('option',{attrs:{\"value\":\"1\"}},[_vm._v(\"1\")]),_vm._v(\" \"),_c('option',{attrs:{\"value\":\"2\"}},[_vm._v(\"2\")]),_vm._v(\" \"),_c('option',{attrs:{\"value\":\"3\"}},[_vm._v(\"3\")]),_vm._v(\" \"),_c('option',{attrs:{\"value\":\"4\"}},[_vm._v(\"4\")]),_vm._v(\" \"),_c('option',{attrs:{\"value\":\"5\"}},[_vm._v(\"5\")])])])]),_vm._v(\" \"),_c('li',{staticClass:\"flex1\"},[_c('div',{staticClass:\"sig_colors\"},[_c('input',{attrs:{\"id\":\"color_val\",\"type\":\"color\",\"readonly\":\"\",\"placeholder\":\"选择颜色\"}})])]),_vm._v(\" \"),_c('li',{staticClass:\"flex1\"},[_c('div',{staticClass:\"sig_bgfile\"},[_c('input',{staticClass:\"upfiles\",attrs:{\"id\":\"upimgs\",\"type\":\"file\",\"accept\":\"image/*\"}}),_vm._v(\" \"),_c('button',{attrs:{\"type\":\"button\"}},[_vm._v(\"上传背景\")])])])])]),_vm._v(\" \"),_c('div',{staticClass:\"btnbox\"},[_c('ul',{staticClass:\"flexbox\"},[_c('li',{staticClass:\"flex1\"},[_c('button',{attrs:{\"id\":\"sig_clear\",\"type\":\"button\"}},[_vm._v(\"清空画布\")])]),_vm._v(\" \"),_c('li',{staticClass:\"flex1\"},[_c('button',{attrs:{\"id\":\"save_sig\",\"type\":\"button\"},on:{\"click\":_vm.createImg}},[_vm._v(\"生成图片\")])])])])])]),_vm._v(\" \"),_c('transition',{attrs:{\"name\":\"fade\"}},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.showSaveStatus),expression:\"showSaveStatus\"}],staticClass:\"create_imgs\"},[_c('div',{staticClass:\"modal_bg\",on:{\"click\":_vm.closeSaveImg}}),_vm._v(\" \"),_c('div',{staticClass:\"create_imgbox\",on:{\"touchstart\":_vm.saveImgs,\"touchend\":_vm.closeSaves}})])])],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7d9298de\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/pages/others/drawingboard.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7d9298de\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./drawingboard.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./drawingboard.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./drawingboard.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7d9298de\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./drawingboard.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-7d9298de\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/others/drawingboard.vue\n// module id = null\n// module chunks = ","module.exports = { \"default\": require(\"core-js/library/fn/json/stringify\"), __esModule: true };\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/core-js/json/stringify.js\n// module id = mvHQ\n// module chunks = 4","var core = require('../../modules/_core');\nvar $JSON = core.JSON || (core.JSON = { stringify: JSON.stringify });\nmodule.exports = function stringify(it) { // eslint-disable-line no-unused-vars\n  return $JSON.stringify.apply($JSON, arguments);\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/core-js/library/fn/json/stringify.js\n// module id = qkKv\n// module chunks = 4"],"sourceRoot":""}