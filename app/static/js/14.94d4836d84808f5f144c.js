webpackJsonp([14],{KwVu:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),n=s.n(i),a={name:"scanfs",data:function(){return{allFiles:"",mp3file:[],cancleLoadings:!1,phoneGUrl:"",isShowMp3:!1,audioIndex:0,playMp3Title:""}},mounted:function(){this.isApp&&(this.phoneGUrl=this.commonFn.rootDirectory()),this.getMp3File()},methods:{scanAllMp3:function(){var t=this;if(this.isApp){var e=api.require("fs");this.fileAll(e,""),api.setKeepScreenOn({keepOn:!0}),this.commonFn.showLoading("正在扫描...");var s=0,i=!1,n=setInterval(function(){console.log(t.cancleLoadings),t.cancleLoadings==i?s=++s:(s=0,i=t.cancleLoadings),16==s&&(t.commonFn.hideLoading(),t.commonFn.showMsg({text:"扫描完成！"}),clearInterval(n),api.setKeepScreenOn({keepOn:!1}))},500)}},fileAll:function(t,e){var s=this,i=this.mp3file?this.mp3file:[];t.readDir({path:s.phoneGUrl+e},function(n,a){if(n.status)if(s.cancleLoadings=!1,n.data&&$api.isArray(n.data))for(var l=0;l<n.data.length;l++)s.regCancle(n.data[l])||function(i){setTimeout(function(){s.fileAll(t,e?e+"/"+n.data[i]:n.data[i])},1800)}(l);else s.regMp3(n.data)&&(0==i.length?i[0]=n.data:i.push(n.data),s.mp3file=i);else s.regMp3(s.phoneGUrl+e)&&(0==i.length?i[0]=s.phoneGUrl+e:i.push(s.phoneGUrl+e),console.log(s.phoneGUrl+e),s.mp3file=i),s.cancleLoadings=!0})},showMp3List:function(){this.isShowMp3=!this.isShowMp3},saveMp3:function(){for(var t=this,e=t.mp3file,s=[],i=0;i<e.length;i++){var a=e[i].split("/"),l={title:a[a.length-1].split(".mp3")[0],url:e[i],singer:"",duration:"",releaseDate:"",like:!1};s[i]=l}this.commonFn.openFiles({filePath:"pingData/phoneAllMp3.txt"}).then(function(e){e.status?t.commonFn.writeFiles({filePath:"pingData/phoneAllMp3.txt",data:n()(s),overwrite:!0}).then(function(e){e.status&&t.commonFn.showMsg({text:"保存成功！"})}):t.commonFn.createFile({filePath:"pingData/phoneAllMp3.txt"}).then(function(e){e.status&&t.commonFn.writeFiles({filePath:"pingData/phoneAllMp3.txt",data:n()(s),overwrite:!0}).then(function(e){e.status&&t.commonFn.showMsg({text:"保存成功！"})})})})},regMp3:function(t){return RegExp(/\.mp3$/).test(t)},regCancle:function(t){return RegExp(/Android$|gifshow$|alipay$|backup$|backups$|DCIM$/).test(t)},getMp3File:function(){var t=this;if(!this.isApp)return!1;this.commonFn.readFiles({filePath:"pingData/phoneAllMp3.txt"}).then(function(e){e.status?(console.log(e.data),t.mp3file=JSON.parse(e.data)):console.log(n()(e))})},showBrowser:function(){var t=this;if(this.isApp){var e=api.require("fileBrowser");e.open(function(s){s&&(t.commonFn.getAttrFile({cancelPath:!0,filePath:s.url}).then(function(t){alert(n()(t))}),e.close())})}},scanAttrMp3:function(){if(!this.isApp)return!1;var t=api.require("fs");this.getFileAttr(t,0,this.mp3file)},getFileAttr:function(t,e,s){var i=this;t.getAttribute({path:s[e]},function(a,l){if(a.status){var o=s,p={};p.fileurl=s[e],p.fileInfo=a,o[e]=p,i.mp3file=o,e+1<o.length?i.getFileAttr(t,++e,o):(i.allMp3File=o,i.strMp3File=n()(o))}else alert(n()(l))})},playMp3:function(){console.log(this.mp3file[this.audioIndex]),this.playMp3Title=this.mp3file[this.audioIndex],api.startPlay({path:this.mp3file[this.audioIndex]},function(t,e){t?alert("播放完成"):alert(n()(e))})},stopPlay:function(){api.stopPlay()},playPrev:function(){api.stopPlay(),this.audioIndex=--this.audioIndex,this.playMp3()},playNext:function(){api.stopPlay(),this.audioIndex=++this.audioIndex,this.playMp3()}}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"scanfs"},[s("div",{staticClass:"scanfsNav"},[s("ul",{staticClass:"list2"},[s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.showBrowser}},[t._v("打开文件浏览")])]),t._v(" "),s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.scanAllMp3}},[t._v("扫描所有mp3文件")])]),t._v(" "),s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.showMp3List}},[t._v(t._s(t.isShowMp3?"隐藏":"显示")+"mp3列表")])]),t._v(" "),s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.saveMp3}},[t._v("保存mp3文件")])]),t._v(" "),t._m(0),t._v(" "),s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.playMp3}},[t._v("播放音乐")])]),t._v(" "),s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.playPrev}},[t._v("播放上一首")])]),t._v(" "),s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.playNext}},[t._v("播放下一首")])]),t._v(" "),s("li",[s("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"},on:{click:t.stopPlay}},[t._v("停止播放")])])])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowMp3,expression:"isShowMp3"}],staticClass:"scanfsMp3"},[s("div",{staticClass:"scanfsMp3List"},[s("h4",{staticClass:"btn_primary"},[t._v("总共扫描到了"),s("span",[t._v(t._s(t.mp3file.length>0?t.mp3file.length:0))]),t._v("首mp3")]),t._v(" "),s("ul",t._l(t.mp3file,function(e,i){return s("li",{key:i},[t._v(t._s(e))])}),0),t._v(" "),s("p",{directives:[{name:"show",rawName:"v-show",value:t.mp3file.length<1,expression:"mp3file.length<1"}]},[t._v("-- 没有文件 --")])])]),t._v(" "),s("div",{staticClass:"playMp3Title"},[t._v(t._s(t.playMp3Title))])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("button",{staticClass:"scanfs_browser jbbg",attrs:{type:"button"}},[this._v("扫描图片")])])}]};var o=s("VU/8")(a,l,!1,function(t){s("yT+f")},null,null);e.default=o.exports},"yT+f":function(t,e){}});