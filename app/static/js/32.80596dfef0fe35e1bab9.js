webpackJsonp([32],{"13eq":function(t,e){},O88V:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={name:"drawingboard",data:function(){return{handleStatus:!1,showNum:0,showSaveStatus:!1,createImgUrl:""}},mounted:function(){this.initDraw()},methods:{initDraw:function(){var t,e,a,i,s=window.devicePixelRatio,n=!1,o=document.getElementById("mycanvas"),c=o.getContext("2d");t=window.innerWidth,e=window.innerHeight;var r=document.querySelector(".main_canvas");r.style.cssText="width:winWidth;height:winHeight",a=t*s,i=e*s,o.width=a,o.height=i,o.width,o.height;var l={x:0,y:0},u={x:0,y:0},d=!1;function v(t){var e=t||window.event;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}o.onmousedown=function(t){l.x=t.pageX-void 0,l.y=t.pageY,d=!0},o.onmousemove=function(t){v(t),n?d&&(l.x=t.pageX-void 0,l.y=t.pageY,u.x=t.pageX-void 0,u.y=t.pageY,w(l.x,l.y,u.x,u.y)):d&&(u.x=t.pageX-void 0,u.y=t.pageY,w(l.x,l.y,u.x,u.y)),n=!1},o.onmouseup=function(t){v(t),d=!1,l.x=0,l.y=0,u.x=0,u.y=0},window.onmouseup=function(){d=!1},window.onmousemove=function(t){(t.pageX>o.width+void 0||t.pageX<o.width+void 0||t.pageY<0||t.pageY>o.height)&&(n=!0)},o.addEventListener("touchstart",function(t){l.x=t.touches[0].clientX*s,l.y=t.touches[0].clientY*s},!1),o.addEventListener("touchmove",function(t){u.x=t.touches[0].clientX*s,u.y=t.touches[0].clientY*s,w(l.x,l.y,u.x,u.y)},!1);var h=1;h*=s;var m="black",g=new Image;function w(t,e,a,i){c.beginPath(),c.restore(),c.save(),c.lineWidth=h,c.strokeStyle=m,c.moveTo(t,e),c.lineTo(a,i),c.stroke(),l.x=a,l.y=i,c.restore(),c.save()}function p(t,e,a,i){c.restore(),c.save(),c.beginPath(),c.drawImage(g,t,e,a,i),c.restore(),c.save()}g.src="",document.getElementById("upimgs").addEventListener("change",function(){var t,e=this.files[0];void 0!=window.createObjectURL?t=window.createObjectURL(e):void 0!=window.URL?t=window.URL.createObjectURL(e):void 0!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),g.src=t,g.onload=function(){var t=g.width/g.height,e=(g.width,g.height,o.width/t),a=o.height*t;e>o.height?p(0,-(e-o.height)/2,o.width,e):e<o.height&&p(-(a-o.width)/2,0,a,o.height)}}),document.getElementById("color_val").addEventListener("input",function(t){m=t.target.value}),document.getElementById("sib_linecx").addEventListener("input",function(t){h=t.target.value}),document.getElementById("sig_clear").addEventListener("click",function(){c.beginPath(),c.clearRect(0,0,o.width,o.height),c.restore(),c.save()});document.getElementById("save_sig"),document.querySelector(".create_imgs"),document.querySelector(".create_imgbox"),document.querySelector(".modal_bg")},showHandles:function(){var t=this;this.showNum=++this.showNum,3==this.showNum&&(this.handleStatus=!0,this.showNum=0),clearTimeout(t.setLoop),t.setLoop=setTimeout(function(){t.showNum=0},1e3)},closeHandle:function(){this.handleStatus=!1,this.showNum=0},touchmoves:function(t){0!=this.showNum&&(this.showNum=0)},createImg:function(){var t=document.getElementById("mycanvas"),e=document.querySelector(".create_imgbox"),a=new Image;a.setAttribute("crossOrigin","Anonymous"),a.src=t.toDataURL("image/png"),this.createImgUrl=t.toDataURL("image/png"),a.style.cssText="width: 100%;display:block;",a.onload=function(){e.appendChild(a)},this.showSaveStatus=!0,this.handleStatus=!1},closeSaveImg:function(){var t=document.querySelector(".create_imgbox");t.removeChild(t.firstChild),this.showSaveStatus=!1},saveImgs:function(){this.commonFn.saveImgsToAlbum({type:"base64",hasbs64:!0,curData:this.createImgUrl})},closeSaves:function(){this.isApp&&clearTimeout(this.saveTime)}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"drawingboard"},[a("div",{staticClass:"main_box"},[a("div",{staticClass:"main_canvas"},[a("canvas",{attrs:{id:"mycanvas"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.showHandles(e)},touchmove:function(e){return e.stopPropagation(),e.preventDefault(),t.touchmoves(e)}}})]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.handleStatus,expression:"handleStatus"}],staticClass:"drawingHBoxbg",on:{click:t.closeHandle}}),t._v(" "),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.handleStatus,expression:"handleStatus"}],staticClass:"drawingHInbox"},[a("div",{staticClass:"signature_btn"},[a("ul",{staticClass:"flexbox"},[a("li",{staticClass:"flex1"},[a("div",{staticClass:"sig_cxline"},[a("select",{attrs:{name:"",id:"sib_linecx"}},[a("option",{attrs:{value:"1"}},[t._v("1")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("2")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("3")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("4")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("5")])])])]),t._v(" "),a("li",{staticClass:"flex1"},[a("div",{staticClass:"sig_colors"},[a("input",{attrs:{id:"color_val",type:"color",readonly:"",placeholder:"选择颜色"}})])]),t._v(" "),a("li",{staticClass:"flex1"},[a("div",{staticClass:"sig_bgfile"},[a("input",{staticClass:"upfiles",attrs:{id:"upimgs",type:"file",accept:"image/*"}}),t._v(" "),a("button",{attrs:{type:"button"}},[t._v("上传背景")])])])])]),t._v(" "),a("div",{staticClass:"btnbox"},[a("ul",{staticClass:"flexbox"},[a("li",{staticClass:"flex1"},[a("button",{attrs:{id:"sig_clear",type:"button"}},[t._v("清空画布")])]),t._v(" "),a("li",{staticClass:"flex1"},[a("button",{attrs:{id:"save_sig",type:"button"},on:{click:t.createImg}},[t._v("生成图片")])])])])])]),t._v(" "),a("transition",{attrs:{name:"fade"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showSaveStatus,expression:"showSaveStatus"}],staticClass:"create_imgs"},[a("div",{staticClass:"modal_bg",on:{click:t.closeSaveImg}}),t._v(" "),a("div",{staticClass:"create_imgbox",on:{touchstart:t.saveImgs,touchend:t.closeSaves}})])])],1)])},staticRenderFns:[]};var n=a("VU/8")(i,s,!1,function(t){a("13eq")},"data-v-57fce4ae",null);e.default=n.exports}});